# Deployment Guide

## üöÄ Quick Deploy to Render

### 1. Prerequisites
- GitHub repository
- Render account
- Cloudinary account
- PostgreSQL database (Render provides this)

### 2. Environment Variables Setup

In your Render service settings, add these environment variables:

```bash
# Database (Auto-generated by Render PostgreSQL)
DATABASE_URL=postgresql://...

# Cloudinary (Required)
CLOUDINARY_CLOUD_NAME=dn1dznhej
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

# Flask
FLASK_ENV=production
```

### 3. Render Configuration

Create `render.yaml` in your repository root:

```yaml
services:
  - type: web
    name: it-servicedesk-api
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn app:app --bind 0.0.0.0:$PORT
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: servicedesk-db
          property: connectionString

databases:
  - name: servicedesk-db
    databaseName: servicedesk
    user: servicedesk_user
```

### 4. Deploy Steps

1. **Connect Repository**
   - Go to Render Dashboard
   - Click "New +" ‚Üí "Web Service"
   - Connect your GitHub repository

2. **Configure Service**
   - Name: `it-servicedesk-api`
   - Environment: `Python 3`
   - Build Command: `pip install -r requirements.txt`
   - Start Command: `gunicorn app:app`

3. **Add Database**
   - Create PostgreSQL database
   - Copy connection string to `DATABASE_URL`

4. **Set Environment Variables**
   - Add all required environment variables
   - Ensure Cloudinary credentials are correct

5. **Deploy**
   - Click "Create Web Service"
   - Wait for deployment to complete

### 5. Post-Deployment

1. **Initialize Database**
   ```bash
   # Run once after first deployment
   python init_postgres_db.py
   ```

2. **Verify Deployment**
   - Visit your service URL
   - Check `/health` endpoint
   - Test `/api/docs/` documentation

3. **Test File Upload**
   - Verify Cloudinary integration
   - Test file upload endpoints

## üîß Manual Deployment

### Local Testing
```bash
# Install dependencies
pip install -r requirements.txt

# Set environment variables
export DATABASE_URL="postgresql://..."
export CLOUDINARY_CLOUD_NAME="dn1dznhej"
export CLOUDINARY_API_KEY="your_key"
export CLOUDINARY_API_SECRET="your_secret"

# Run application
python app.py
```

### Production Server
```bash
# Install Gunicorn
pip install gunicorn

# Run with Gunicorn
gunicorn app:app --bind 0.0.0.0:5000 --workers 4
```

## üìä Health Checks

After deployment, verify these endpoints:

- `GET /health` - Basic health check
- `GET /api/docs/` - API documentation
- `GET /api/tickets` - Data connectivity
- `POST /api/files/cloudinary/upload` - File upload

## üêõ Troubleshooting

### Common Issues

1. **Database Connection Error**
   - Verify `DATABASE_URL` is correct
   - Ensure database is created and accessible

2. **Cloudinary Upload Fails**
   - Check environment variables are set
   - Verify cloud name matches your account

3. **404 Errors**
   - Ensure all routes are properly registered
   - Check blueprint registration in `__init__.py`

4. **CORS Issues**
   - Verify CORS configuration in application
   - Check allowed origins for production

### Logs and Monitoring

- Check Render service logs for errors
- Monitor response times and performance
- Set up alerts for service health

## üîÑ Updates and Maintenance

### Updating Code
1. Push changes to GitHub
2. Render auto-deploys from main branch
3. Monitor deployment logs
4. Verify functionality after deployment

### Database Migrations
```bash
# If using Flask-Migrate
flask db upgrade
```

### Backup Strategy
- Render PostgreSQL includes automated backups
- Consider additional backup solutions for critical data

## üìà Scaling

### Performance Optimization
- Monitor response times
- Optimize database queries
- Consider caching strategies
- Scale worker processes as needed

### Resource Scaling
- Upgrade Render plan for more resources
- Consider database scaling options
- Monitor memory and CPU usage

---

**Your IT ServiceDesk API is now production-ready! üéâ**